#!/bin/bash
set -e

CONFIG_PATH="/etc/v3xctrl/config.json"

# TODO: jq is rather slow - it might make sense to do parsing via python script
# instead
FAILSAFE_THROTTLE=$(jq -r '.controls.throttle.failsafe' "$CONFIG_PATH")
FAILSAFE_STEERING=$(jq -r '.controls.steering.failsafe' "$CONFIG_PATH")

GPIO_THROTTLE=18
GPIO_STEERING=13

pigs s $GPIO_THROTTLE $FAILSAFE_THROTTLE
pigs s $GPIO_STEERING $FAILSAFE_STEERING
