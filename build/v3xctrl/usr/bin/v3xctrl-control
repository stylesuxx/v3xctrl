#!/bin/bash
set -e

ENV_PATH="/run/v3xctrl.env"
source "${ENV_PATH}"

ARGS=""
if [ "$controls_steering_invert" = "true" ]; then
  ARGS+="--steering-invert"
fi

v3xctrl-python -m v3xctrl_control.helpers.client "${server_host}" "${ports_control}" "${ports_control_bind}" \
  --throttle-min "${controls_throttle_min}" \
  --throttle-max "${controls_throttle_max}" \
  --throttle-idle "${controls_throttle_idle}" \
  --forward-scale "${controls_throttle_scaleForward}" \
  --reverse-scale "${controls_throttle_scaleReverse}" \
  --forward-boost "${controls_throttle_minForward}" \
  --reverse-boost "${controls_throttle_minReverse}" \
  --steering-min "${controls_steering_min}" \
  --steering-max "${controls_steering_max}" \
  --steering-trim "${controls_steering_trim}" \
  --steering-scale "${controls_steering_scale}" \
  --gpio-throttle "${controls_gpio_throttle}" \
  --gpio-steering "${controls_gpio_steering}" \
  --modem-path "${modem_path}" --log "${extras_logLevel}" \
  ${ARGS}
