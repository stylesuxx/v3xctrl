#! /bin/bash
# Start video and control services if autostart is enabled
set -e

ENV_PATH="/run/v3xctrl.env"
source "${ENV_PATH}"

# Client or AP mode, falls to AP if can not connect to default network
rc-route-manager "${wifi_routing}"

if [ "$server_mode" = "rendezvous" ]; then
  echo "Registering with rendezvous server..."
  v3xctrl-rendezvous
fi

if [ "$autostart_video" = "true" ]; then
  echo "Starting video service..."
  systemctl start v3xctrl-video
fi

if [ "$autostart_control" = "true" ]; then
  echo "Starting control service..."
  systemctl start rc-control
fi

if [ "$extras_samba" = "true" ]; then
  echo "Starting samba service..."
  systemctl start smbd
fi

exit 0
