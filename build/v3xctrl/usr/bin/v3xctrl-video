#! /bin/bash
set -e

ENV_PATH="/run/v3xctrl.env"
source "${ENV_PATH}"

ARGS=(
  "$server_host"
  "$ports_video"
  "$ports_video_bind"
  --width "$video_width"
  --height "$video_height"
  --framerate "$video_framerate"
  --bitrate "$video_bitrate"
  --i-frame-period "$video_iFramePeriod"
)

if [ "$video_record" = "true" ] && [ -n "$video_recordPath" ] && [ "$video_recordPath" != "null" ]; then
  ARGS+=(--recording-dir "$video_recordPath")
fi

if [ "$video_testSource" = "true" ]; then
  ARGS+=(--test-pattern)
fi

/usr/share/${NAME}/gst/transmit-stream.sh "${ARGS[@]}"
