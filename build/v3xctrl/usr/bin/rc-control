#!/bin/bash
set -e

CONFIG_PATH="/etc/v3xctrl/config.json"
HOST=$(jq -r '.host' "$CONFIG_PATH")
PORT=$(jq -r '.ports.control' "$CONFIG_PATH")

THROTTLE_MIN=$(jq -r '.controls.throttle.min' "$CONFIG_PATH")
THROTTLE_MAX=$(jq -r '.controls.throttle.max' "$CONFIG_PATH")
THROTTLE_IDLE=$(jq -r '.controls.throttle.idle' "$CONFIG_PATH")

STEERING_MIN=$(jq -r '.controls.steering.min' "$CONFIG_PATH")
STEERING_MAX=$(jq -r '.controls.steering.max' "$CONFIG_PATH")
STEERING_TRIM=$(jq -r '.controls.steering.trim' "$CONFIG_PATH")

rc-python -m rpi_4g_streamer.helpers.client "${HOST}" "${PORT}" \
  --throttle-min "${THROTTLE_MIN}" --throttle-max "${THROTTLE_MAX}" \
  --throttle-idle "${THROTTLE_IDLE}" \
  --steering-min "${STEERING_MIN}" --steering-max "${STEERING_MAX}" \
  --steering-trim "${STEERING_TRIM}"
