#! /bin/bash
# Start video and control services if autostart is enabled
set -e

ENV_PATH="/run/v3xctrl.env"
source "${ENV_PATH}"

if [ "$video_camera_enableHdr" = "true" ]; then
  echo "Enable HDR mode..."
  v4l2-ctl -d /dev/v4l-subdev0 --set-ctrl wide_dynamic_range=1
fi

if [ "$server_mode" = "rendezvous" ]; then
  echo "Registering with rendezvous server..."
  v3xctrl-rendezvous
fi

if [ "$server_mode" = "relay" ]; then
  echo "Registering with relay server..."
  v3xctrl-relay
fi

if [ "$modem_limitBands" = "true" ]; then
  echo "Limiting bands..."
  v3xctrl-set-bands $modem_allowedBands
fi

if [ "$autostart_video" = "true" ]; then
  echo "Starting video service..."
  systemctl start v3xctrl-video
fi

if [ "$autostart_control" = "true" ]; then
  echo "Starting control service..."
  systemctl start v3xctrl-control
fi

if [ "$extras_samba" = "true" ]; then
  echo "Starting samba service..."
  systemctl start smbd
fi

exit 0
