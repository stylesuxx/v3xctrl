{
  "title": "Configuration",
  "type": "object",
  "options": {
    "disable_collapse": true
  },
  "properties": {
    "server": {
      "propertyOrder": 10,
      "title": "Server",
      "type": "object",
      "options": {
        "collapsed": false
      },
      "properties": {
        "mode": {
          "propertyOrder": 10,
          "title": "Connection Mode",
          "type": "string",
          "enum": ["direct", "relay"],
          "required": true,
          "default": "direct",
          "description": "Choose how the client connects to the server."
        },
        "host": {
          "propertyOrder": 20,
          "type": "string",
          "title": "Host",
          "default": "192.168.0.1",
          "description": "Used in direct mode only"
        },
        "relaySessionId": {
          "propertyOrder": 30,
          "type": "string",
          "title": "Relay Session ID",
          "default": "test123",
          "description": "Needs to be the same on client and server"
        },
        "relayServer": {
          "propertyOrder": 40,
          "type": "string",
          "title": "UDP Relay Server",
          "default": "rendezvous.websium.at:8888",
          "description": "Used in relay mode only (only change if you are using your own relay server)"
        }
      }
    },
    "video": {
      "propertyOrder": 30,
      "type": "object",
      "title": "Video",
      "options": {
        "collapsed": true
      },
      "properties": {
        "width": {
          "propertyOrder": 10,
          "title": "Width",
          "description": "This setting must also be adjusted in the viewer to match",
          "type": "integer",
          "default": 1280
        },
        "height": {
          "propertyOrder": 20,
          "title": "Height",
          "description": "This setting must also be adjusted in the viewer to match",
          "type": "integer",
          "default": 720
        },
        "framerate": {
          "propertyOrder": 30,
          "title":" FPS",
          "description": "This setting must also be adjusted in the viewer to match",
          "type": "integer",
          "default": 30
        },
        "iFramePeriod": {
          "propertyOrder": 40,
          "title":" I-frame interval",
          "type": "integer",
          "default": 15,
          "description": "I-frame interval controls how often a complete reference frame is encoded in the video stream. Smaller intervals provide better quality for fast-moving scenes and faster recovery from packet loss, but use more bandwidth since complete frames are larger than the delta frames sent between them."
        },
        "bitrate": {
          "propertyOrder": 50,
          "title": "Bitrate",
          "required": true,
          "type": "integer",
          "enum": [
            50000000,
            40000000,
            30000000,
            20000000,
            10000000,
            5000000,
            4800000,
            4600000,
            4400000,
            4200000,
            4000000,
            3800000,
            3600000,
            3400000,
            3200000,
            3000000,
            2800000,
            2600000,
            2400000,
            2200000,
            2000000,
            1800000,
            1600000,
            1400000,
            1200000,
            1000000,
            800000
          ],
          "options": {
            "enum_titles": [
              "50.0 Mbps (theoretical maximum for 4G, CAT-3)",
              "40.0 Mbps",
              "30.0 Mbps",
              "20.0 Mbps (realistic maximum for 4G, CAT-3)",
              "10.0 Mbps",
              "5.0 Mbps (theoretical maximum fro 4G, Cat-1)",
              "4.8 Mbps",
              "4.6 Mbps",
              "4.4 Mbps",
              "4.2 Mbps",
              "4.0 Mbps",
              "3.8 Mbps",
              "3.6 Mbps",
              "3.4 Mbps",
              "3.2 Mbps",
              "3.0 Mbps (realistic maximum for 4G, CAT-1)",
              "2.8 Mbps",
              "2.6 Mbps",
              "2.4 Mbps",
              "2.2 Mbps",
              "2.0 Mbps",
              "1.8 Mbps (Default for average 4G, CAT-1)",
              "1.6 Mbps",
              "1.4 Mbps",
              "1.2 Mbps",
              "1.0 Mbps",
              "800 kbps"
            ]
          },
          "default": 1800000,
          "description": "Stay below values your modem supports (based on category). If latency increases, reduce this value."
        },
        "qp": {
          "propertyOrder": 60,
          "type": "object",
          "description": "Controls quality-bitrate tradeoff. Lower QP = higher quality/larger files, higher QP = lower quality/smaller files.",
          "title": "Quantization Parameter (QP)",
          "options": {
            "collapsed": false
          },
          "properties": {
            "min": {
              "propertyOrder": 10,
              "type": "integer",
              "default": 20,
              "minimum": 0,
              "maximum": 51,
              "title": "Min QP",
              "description": "Highest quality allowed. Lower = better quality, larger frames."
            },
            "max": {
              "propertyOrder": 20,
              "type": "integer",
              "default": 51,
              "minimum": 0,
              "maximum": 51,
              "title": "Max QP",
              "description": "Lowest quality allowed. Higher = more compression, smaller frames."
            }
          }
        },
        "maxIframeBytes": {
          "propertyOrder": 70,
          "title":"Maximum I-frame bytes",
          "type": "integer",
          "default": 25600,
          "description": "Used for auto adjusting I-frames to a specific size"
        },
        "enableIframeAdjust": {
          "propertyOrder": 80,
          "title": "Enable auto adjusting I Frame size",
          "type": "boolean",
          "format": "checkbox",
          "default": false,
          "description": "This automatically adjusts the compression quality (QP) of I-frames to keep them under a specified size limit. It trades off I-frame quality to prevent bandwidth spikes when reference frames are transmitted."
        },
        "record": {
          "propertyOrder": 90,
          "title": "Record",
          "type": "boolean",
          "format": "checkbox",
          "default": false,
          "description": "Record video stream locally on the device (requires high-quality SD card)"
        },
        "recordPath": {
          "propertyOrder": 100,
          "title": "Record Path",
          "type": "string",
          "default": "/data/recordings",
          "description": "Path to store recordings"
        },
        "testSource": {
          "propertyOrder": 110,
          "title": "Test image",
          "type": "boolean",
          "format": "checkbox",
          "default": true,
          "description": "Use test image instead of camera - great for debugging, disable once you made sure video transmission is working"
        },
        "camera": {
          "propertyOrder": 120,
          "type": "object",
          "title": "Camera Settings",
          "options": {
            "collapsed": false
          },
          "properties": {
            "enableHdr": {
              "propertyOrder": 10,
              "title": "Enable HDR",
              "description": "Only supported on PiCam V3 - highly recommended (more FOV and better handling of dark/bright transitions)",
              "type": "boolean",
              "format": "checkbox",
              "default": false
            },
            "afMode": {
              "propertyOrder": 20,
              "title": "Auto focus",
              "type": "integer",
              "required": true,
              "enum": [
                0,
                2
              ],
              "options": {
                "enum_titles": [
                  "Disabled",
                  "Continous"
                ]
              },
              "default": 2,
              "description": "Only supported on PiCam V3 - if auto focus is disabled, lens position will be applied"
            },
            "lensPosition": {
              "propertyOrder": 30,
              "title": "Lens position",
              "type": "number",
              "default": 0,
              "description": "Only applied when autofocus is disabled. 0: Infinity; Focus(m) = 1/value; Eg.: value = 0.5, Focus = 2m"
            },
            "analogueGainMode": {
              "propertyOrder": 40,
              "title": "Gain Control",
              "type": "integer",
              "required": true,
              "enum": [0, 1],
              "options": {
                "enum_titles": ["Automatic", "Manual"]
              },
              "default": 1,
              "description": "Control how the sensor gain is adjusted. Automatic mode adjusts gain based on lighting conditions; manual mode uses the fixed value below."
            },
            "analogueGain": {
              "propertyOrder": 50,
              "title": "Gain Level",
              "type": "integer",
              "required": true,
              "enum": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16],
              "default": 1,
              "description": "Sensor gain multiplier (1-16). Higher values brighten the image in low light but increase noise. Use the lowest value that provides adequate brightness."
            },
            "exposureTimeMode": {
              "propertyOrder": 60,
              "title": "Exposure Control",
              "type": "integer",
              "required": true,
              "enum": [0, 1],
              "options": {
                "enum_titles": ["Automatic", "Manual"]
              },
              "default": 0,
              "description": "Control how exposure time is determined. Automatic mode adjusts exposure based on lighting conditions; manual mode uses the fixed value below."
            },
            "exposureTime": {
              "propertyOrder": 70,
              "title": "Exposure Time (Î¼s)",
              "type": "integer",
              "required": true,
              "default": 32000,
              "description": "Exposure duration in microseconds. Higher values brighten the image but increase motion blur. For video streaming, use the shortest time that provides adequate brightness."
            },
            "sensorMode": {
              "propertyOrder": 80,
              "title": "Force wide FOV",
              "type": "string",
              "required": true,
              "enum": [
                "0x0",
                "2304x1296"
              ],
              "options": {
                "enum_titles": [
                  "Disabled",
                  "RPi Cam v3, Arducam IMX708"
                ]
              },
              "default": "0x0",
              "description": "Some image sensors have wider FOV when requesting higher resolutions. With this setting you can force those higher resolutions to benefit from wider FOV."
            },
            "brightness": {
              "propertyOrder": 90,
              "title": "Brightness",
              "type": "number",
              "required": true,
              "default": 0.0,
              "minimum": -1.0,
              "maximum": 1.0,
              "description": "Change brightness in camera (not supported by all cameras)"
            },
            "contrast": {
              "propertyOrder": 100,
              "title": "Contrast",
              "type": "number",
              "required": true,
              "default": 1.0,
              "minimum": 0.0,
              "maximum": 2.0,
              "description": "Change contrast in camera (not supported by all cameras)"
            },
            "saturation": {
              "propertyOrder": 110,
              "title": "Saturation",
              "type": "number",
              "required": true,
              "default": 1.0,
              "minimum": 0.0,
              "maximum": 2.0,
              "description": "Change saturtion in camera (not supported by all cameras)"
            },
            "sharpness": {
              "propertyOrder": 120,
              "title": "Sharpness",
              "type": "number",
              "required": true,
              "default": 0.0,
              "minimum": 0.0,
              "maximum": 10.0,
              "description": "Change sharpness in camera (not supported by all cameras)"
            }
          }
        }
      }
    },
    "network": {
      "propertyOrder": 40,
      "type": "object",
      "title": "Network",
      "options": {
        "collapsed": true
      },
      "properties": {
        "ports": {
          "propertyOrder": 10,
          "type": "object",
          "title": "Ports",
          "options": {
            "collapsed": false
          },
          "properties": {
            "video": {
              "propertyOrder": 10,
              "type": "integer",
              "default": 6666,
              "description": "Port for outgoing video stream"
            },
            "control": {
              "propertyOrder": 20,
              "type": "integer",
              "default": 6668,
              "description": "The port for the bi-directional control channel"
            },
            "webinterface": {
              "propertyOrder": 30,
              "type": "integer",
              "default": 5000,
              "description": "The port on which this interface should be running (requires reboot)"
            }
          }
        },
        "wifi": {
          "propertyOrder": 20,
          "type": "object",
          "title": "WiFi",
          "options": {
            "collapsed": false
          },
          "properties": {
            "mode": {
              "type": "string",
              "required": true,
              "enum": [
                "client",
                "ap"
              ],
              "description": "In client mode, the device connects to an existing network. In access-point mode, the device creates its own WiFi network."
            },
            "routing": {
              "type": "string",
              "required": true,
              "enum": [
                "wlan",
                "rndis"
              ],
              "description": "Which interface routes internet traffic. Use wlan during initial setup, then switch to rndis once tested."
            }
          }
        },
        "modem": {
          "propertyOrder": 30,
          "type": "object",
          "title": "Modem",
          "options": {
            "collapsed": false
          },
          "properties": {
            "model": {
              "propertyOrder": 10,
              "required": true,
              "title": "Model",
              "type": "string",
              "enum": [
                "generic",
                "mzuzone-cat1_lte",
                "mzuzone-cat1_gps",
                "mzuzone-cat1_eu",
                "mzuzone-cat1_ea"
              ],
              "options": {
                "enum_titles": [
                  "Generic",
                  "McuZone Cat1 LTE",
                  "McuZone Cat1 GPS",
                  "McuZone Cat1 EU",
                  "McuZone Cat1 EA"
                ]
              }
            },
            "path": {
              "propertyOrder": 20,
              "title": "Path",
              "type": "string",
              "description": "Path to the modem device",
              "default": "/dev/eigencomm-at"
            },
            "limitBands": {
              "title": "Limit Bands",
              "propertyOrder": 30,
              "type": "boolean",
              "format": "checkbox",
              "default": false,
              "description": "Sometimes it might be beneficial to limit 4G bands, only change this if you know what and why you are doing this. By default, this decision is left up to the firmware of your modem. Once set, this setting is persistent! Make sure you know which values are your modems default, so you can return to the correct ones."
            },
            "allowedBands": {
              "type": "array",
              "title": "Allowed Bands",
              "propertyOrder": 40,
              "items": {
                "type": "number",
                "enum": [
                  1,
                  3,
                  5,
                  7,
                  8,
                  20,
                  28,
                  34,
                  38,
                  39,
                  40,
                  41
                ]
              },
              "uniqueItems": true,
              "default": []
            }
          }
        }
      }
    },
    "autostart": {
      "propertyOrder": 50,
      "type": "object",
      "title": "Autostart",
      "options": {
        "collapsed": true
      },
      "description": "Before enabling autostart, make sure that the services work fine when started manually.",
      "properties": {
        "video": {
          "propertyOrder": 10,
          "type": "boolean",
          "format": "checkbox",
          "default": true,
          "description": "Automatically start video stream after boot"
        },
        "control": {
          "propertyOrder": 20,
          "type": "boolean",
          "format": "checkbox",
          "default": true,
          "description": "Automatically start control channel after boot"
        }
      }
    },
    "controls": {
      "propertyOrder": 60,
      "type": "object",
      "title": "Controls",
      "options": {
        "collapsed": true
      },
      "properties": {
        "throttle": {
          "propertyOrder": 10,
          "type": "object",
          "title": "Throttle",
          "options": {
            "collapsed": false
          },
          "properties": {
            "min": {
              "propertyOrder": 10,
              "type": "integer",
              "default": 1000,
              "description": "Minimum pulse width"
            },
            "max": {
              "propertyOrder": 20,
              "type": "integer",
              "default": 2000,
              "description": "Maximum pulse width"
            },
            "failsafe": {
              "propertyOrder": 30,
              "type": "integer",
              "default": 1000,
              "description": "Pulse width when failsafe"
            },
            "idle": {
              "propertyOrder": 40,
              "type": "integer",
              "default": 1200,
              "description": "Pulsewidth for throttle position between forwards and brake/backwards"
            },
            "scaleForward": {
              "propertyOrder": 50,
              "type": "integer",
              "default": 100,
              "minimum": 1,
              "maximum": 100,
              "description": "Scales the throttle forward range as a percentage of the maximum possible value"
            },
            "scaleReverse": {
              "propertyOrder": 60,
              "type": "integer",
              "default": 100,
              "minimum": 1,
              "maximum": 100,
              "description": "Scales the throttle reverse range as a percentage of the maximum possible value"
            },
            "minForward": {
              "propertyOrder": 70,
              "type": "integer",
              "default": 0,
              "description": "Compensate for 'dead-zone' of ESC. Set this to a value just slightly before the motor starts spinning forward."
            },
            "minReverse": {
              "propertyOrder": 80,
              "type": "integer",
              "default": 0,
              "description": "Compensate for 'dead-zone' of ESC. Set this to a value just slightly before the motor starts spinning reverse."
            }
          }
        },
        "steering": {
          "propertyOrder": 20,
          "type": "object",
          "title": "Steering",
          "options": {
            "collapsed": false
          },
          "properties": {
            "min": {
              "propertyOrder": 10,
              "type": "integer",
              "default": 1000,
              "description": "Minimum pulse width"
            },
            "max": {
              "propertyOrder": 20,
              "type": "integer",
              "default": 2000,
              "description": "Maximum pulse width"
            },
            "failsafe": {
              "propertyOrder": 30,
              "type": "integer",
              "default": 1500,
              "description": "Pulse width when failsafe"
            },
            "trim": {
              "propertyOrder": 40,
              "type": "integer",
              "default": 0,
              "description": "Pulse width for trim"
            },
            "scale": {
              "propertyOrder": 50,
              "title": "Scale (in percent)",
              "type": "integer",
              "default": 100,
              "minimum": 1,
              "maximum": 100,
              "description": "Scales the steering output range as a percentage of the maximum possible value"
            },
            "invert": {
              "propertyOrder": 60,
              "title": "Invert steering",
              "type": "boolean",
              "format": "checkbox",
              "default": false,
              "description": "Invert steering direction"
            }
          }
        },
        "failsafeTimeout": {
          "propertyOrder": 30,
          "type": "integer",
          "default": 150,
          "description": "After this many ms without a control packet, failsafe is triggered"
        },
        "pwm":{
          "propertyOrder":40,
          "type": "object",
          "title": "PWM Channel Mapping",
          "options": {
          "collapsed": false
          },
          "properties": {
            "throttle": {
              "title": "Throttle PWM channel",
              "propertyOrder": 10,
              "type": "integer",
              "default": 0,
              "required": true,
              "description": "PWM channel for ESC",
              "enum": [
                0,
                1
              ],
              "options": {
                "enum_titles": [
                  "0 (Pin 18)",
                  "1 (Pin 13)"
                ]
              }
            },
            "steering": {
              "propertyOrder": 20,
              "title": "Steering PWM channel",
              "type": "integer",
              "default": 1,
              "required": true,
              "description": "PWM channel for Servo",
              "enum": [
                0,
                1
              ],
              "options": {
                "enum_titles": [
                  "0 (Pin 18)",
                  "1 (Pin 13)"
                ]
              }
            }
          }
        }
      }
    },
    "telemetry": {
      "propertyOrder": 70,
      "type": "object",
      "title": "Telemetry",
      "options": {
        "collapsed": true,
        "disable_edit_json": true,
        "disable_properties": true
      },
      "properties": {
        "battery": {
          "title": "Battery",
          "propertyOrder": 10,
          "type": "object",
          "options": {
            "collapsed": false,
            "disable_edit_json": true,
            "disable_properties": true
          },
          "properties": {
            "i2cAddress": {
              "title": "I2C Address",
              "propertyOrder": 10,
              "type": "string",
              "required": true,
              "default": "0x40",
              "description": "I2C address of the INA sensor"
            },
            "minVoltage": {
              "title": "Minimum Voltage",
              "propertyOrder": 20,
              "type": "number",
              "required": true,
              "default": 3.5,
              "description": "Minimum voltage per cell (used to calculate battery percentage)"
            },
            "maxVoltage": {
              "title": "Maximum Voltage",
              "propertyOrder": 30,
              "type": "number",
              "required": true,
              "default": 4.2,
              "description": "Maximum voltage per cell (used to calculate battery percentage)"
            },
            "warnVoltage": {
              "title": "Warning Voltage",
              "propertyOrder": 40,
              "type": "number",
              "required": true,
              "default": 3.7,
              "description": "Level at which low voltage warnings should be triggered"
            }
          }
        }
      }
    },
    "extras": {
      "propertyOrder": 80,
      "type": "object",
      "title": "Extras",
      "options": {
        "collapsed": true
      },
      "properties": {
        "samba": {
          "title": "SAMBA",
          "propertyOrder": 10,
          "type": "boolean",
          "format": "checkbox",
          "default": false,
          "description": "Enable SAMBA network share for recording directory"
        },
        "logLevel": {
          "title": "Log Level",
          "propertyOrder": 20,
          "type": "string",
          "required": true,
          "default": "ERROR",
          "enum": [
            "CRITICAL",
            "ERROR",
            "WARNING",
            "INFO",
            "DEBUG"
          ]
        },
        "reverseShellUrl": {
          "title": "Reverse Shell URL",
          "description": "CAUTION: Only set a reverse shell URL if you know what you are doing, this is for remote debugging only.",
          "pro pertyOrder": 20,
          "type": "string",
          "default": null
        }
      }
    }
  }
}