{
  "title": "Configuration",
  "type": "object",
  "options": {
    "disable_collapse": true
  },
  "properties": {
    "network": {
      "propertyOrder": 10,
      "type": "object",
      "title": "Network",
      "description": "Viewer, WiFi and Modem settings.<br/><i>Changes in this section require the streamer to be restarted!</i>",
      "options": {
        "collapsed": true
      },
      "properties": {
        "routing": {
          "propertyOrder": 10,
          "title": "Routing",
          "description": "Which interface routes internet traffic. Use 'WiFi' during initial setup, then switch to 'LTE/4G' once tested.",
          "type": "string",
          "required": true,
          "enum": [
            "wlan",
            "rndis"
          ],
          "options": {
            "enum_titles": [
              "WiFi",
              "LTE/4G"
            ]
          }
        },
        "server": {
          "propertyOrder": 20,
          "title": "Viewer",
          "description": "Connection settings for viewer and relay.<br/><i>Changes in this section require the 'v3xctrl-service-manager' service to be restarted!</i>",
          "type": "object",
          "options": {
            "collapsed": true
          },
          "properties": {
            "mode": {
              "propertyOrder": 10,
              "title": "Connection Mode",
              "type": "string",
              "enum": [
                "direct",
                "relay"
              ],
              "options": {
                "enum_titles": [
                  "Direct",
                  "Relay server"
                ]
              },
              "required": true,
              "default": "direct",
              "description": "Choose how the client connects to the server."
            },
            "direct": {
              "propertyOrder": 20,
              "title": "Direct Connection",
              "description": "Connection settings for direct P2P connection.",
              "type": "object",
              "options": {
                "collapsed": true
              },
              "properties": {
                "host": {
                  "propertyOrder": 20,
                  "type": "string",
                  "title": "Host",
                  "default": "192.168.1.100",
                  "description": "Target host running the viewer. IP address is preferred but domain name is fine. (Used in direct mode only)"
                }
              }
            },
            "relay": {
              "propertyOrder": 30,
              "title": "Relay Server",
              "description": "Connection settings for relay connection.",
              "type": "object",
              "options": {
                "collapsed": true
              },
              "properties": {
                "sessionId": {
                  "propertyOrder": 30,
                  "type": "string",
                  "title": "Session ID",
                  "default": "test123",
                  "description": "Needs to be the same on streamer and viewer."
                },
                "host": {
                  "propertyOrder": 40,
                  "type": "string",
                  "title": "Relay Server",
                  "default": "relay.v3xctrl.com:8888",
                  "description": "Change if you are using your own relay server."
                }
              }
            },
            "ports": {
              "propertyOrder": 40,
              "type": "object",
              "title": "Ports",
              "description": "Outgoing ports. In direct mode those MUST match the viewers ports",
              "options": {
                "collapsed": true
              },
              "properties": {
                "video": {
                  "propertyOrder": 10,
                  "type": "integer",
                  "default": 16384,
                  "title" : "Video port",
                  "description": "Port for outgoing video stream."
                },
                "control": {
                  "propertyOrder": 20,
                  "type": "integer",
                  "default": 16386,
                  "title" : "Control port",
                  "description": "Port for the bi-directional control channel."
                }
              }
            }
          }
        },
        "wifi": {
          "propertyOrder": 30,
          "type": "object",
          "title": "WiFi",
          "description": "Settings related to the WiFi device.",
          "options": {
            "collapsed": true
          },
          "properties": {
            "mode": {
              "type": "string",
              "required": true,
              "enum": [
                "client",
                "ap"
              ],
              "options": {
                "enum_titles": [
                  "Client",
                  "Access Point"
                ]
              },
              "title": "WiFI",
              "description": "In client mode, the device connects to an existing network. In access-point mode, the device creates its own WiFi network."
            }
          }
        },
        "modem": {
          "propertyOrder": 40,
          "type": "object",
          "title": "Modem",
          "description": "Settings related to the LTE/4G modem.",
          "options": {
            "collapsed": true
          },
          "properties": {
            "model": {
              "propertyOrder": 10,
              "required": true,
              "title": "Model",
              "type": "string",
              "enum": [
                "generic",
                "mzuzone-cat1_lte",
                "mzuzone-cat1_gps",
                "mzuzone-cat1_eu",
                "mzuzone-cat1_ea"
              ],
              "options": {
                "enum_titles": [
                  "Generic",
                  "McuZone Cat1 LTE",
                  "McuZone Cat1 GPS",
                  "McuZone Cat1 EU",
                  "McuZone Cat1 EA"
                ]
              },
              "description": "Set this to your actual modem, this is used for band limiting and feature detection. Some features will not work properly if this is not set correctly."
            },
            "path": {
              "propertyOrder": 20,
              "title": "Path",
              "type": "string",
              "description": "Path to the modem device",
              "default": "/dev/eigencomm-at"
            },
            "limitBands": {
              "title": "Limit Bands",
              "propertyOrder": 30,
              "type": "boolean",
              "format": "checkbox",
              "default": false,
              "description": "Sometimes it might be beneficial to limit 4G bands, only change this if you know what and why you are doing this. By default, this decision is left up to the firmware of your modem. Once set, this setting is persistent! Make sure you know which values are your modems default, so you can return to the correct ones."
            },
            "allowedBands": {
              "type": "array",
              "title": "Allowed Bands",
              "propertyOrder": 40,
              "items": {
                "type": "number",
                "enum": [
                  1,
                  3,
                  5,
                  7,
                  8,
                  20,
                  28,
                  34,
                  38,
                  39,
                  40,
                  41
                ]
              },
              "uniqueItems": true,
              "default": [],
              "description": "If above checkbox is set, the bands will be limited to the selected ones. (Be aware that not all modems respect this limitation)"
            }
          }
        },
        "extras": {
          "propertyOrder": 50,
          "type": "object",
          "title": "Extras",
          "description": "Miscelanious networking related settings.",
          "options": {
            "collapsed": true
          },
          "properties": {
            "samba": {
              "title": "SAMBA",
              "propertyOrder": 10,
              "type": "boolean",
              "format": "checkbox",
              "default": false,
              "description": "Enable SAMBA network share for recording directory"
            },
            "reverseShellUrl": {
              "title": "Reverse Shell URL",
              "description": "CAUTION: Only set a reverse shell URL if you know what you are doing, this is for remote debugging only.",
              "propertyOrder": 20,
              "type": "string",
              "default": null
            }
          }
        }
      }
    },
    "video": {
      "propertyOrder": 20,
      "type": "object",
      "title": "Video",
      "description": "Video, camera and Encoder settings.<br/><i>Changes in this section require the 'v3xctrl-video' service to be restarted!</i>",
      "options": {
        "collapsed": true
      },
      "properties": {
        "autostart": {
          "propertyOrder": 10,
          "type": "boolean",
          "format": "checkbox",
          "default": false,
          "title": "Autostart",
          "description": "Automatically start video stream after boot"
        },
        "testSource": {
          "propertyOrder": 20,
          "title": "Transmit test image",
          "type": "boolean",
          "format": "checkbox",
          "default": true,
          "description": "Use test image instead of camera - great for debugging, disable once you made sure video transmission is working"
        },
        "width": {
          "propertyOrder": 30,
          "title": "Width",
          "description": "This setting must also be adjusted in the viewer to match",
          "type": "integer",
          "default": 1280
        },
        "height": {
          "propertyOrder": 40,
          "title": "Height",
          "description": "This setting must also be adjusted in the viewer to match",
          "type": "integer",
          "default": 720
        },
        "framerate": {
          "propertyOrder": 50,
          "title": "FPS",
          "description": "This setting must also be adjusted in the viewer to match",
          "type": "integer",
          "default": 30
        },
        "bitrate": {
          "propertyOrder": 60,
          "title": "Bitrate",
          "required": true,
          "type": "integer",
          "enum": [
            50000000,
            40000000,
            30000000,
            20000000,
            10000000,
            5000000,
            4800000,
            4600000,
            4400000,
            4200000,
            4000000,
            3800000,
            3600000,
            3400000,
            3200000,
            3000000,
            2800000,
            2600000,
            2400000,
            2200000,
            2000000,
            1800000,
            1600000,
            1400000,
            1200000,
            1000000,
            800000
          ],
          "options": {
            "enum_titles": [
              "50.0 Mbps (theoretical maximum for 4G, CAT-3)",
              "40.0 Mbps",
              "30.0 Mbps",
              "20.0 Mbps (realistic maximum for 4G, CAT-3)",
              "10.0 Mbps",
              "5.0 Mbps (theoretical maximum for 4G, Cat-1)",
              "4.8 Mbps",
              "4.6 Mbps",
              "4.4 Mbps",
              "4.2 Mbps",
              "4.0 Mbps",
              "3.8 Mbps",
              "3.6 Mbps",
              "3.4 Mbps",
              "3.2 Mbps",
              "3.0 Mbps (realistic maximum for 4G, CAT-1)",
              "2.8 Mbps",
              "2.6 Mbps",
              "2.4 Mbps",
              "2.2 Mbps",
              "2.0 Mbps",
              "1.8 Mbps (Default for average 4G, CAT-1)",
              "1.6 Mbps",
              "1.4 Mbps",
              "1.2 Mbps",
              "1.0 Mbps",
              "800 kbps"
            ]
          },
          "default": 1800000,
          "description": "Stay below values your modem supports (based on category). If latency increases, reduce this value. The default is very conservative, you can most likely increase this value."
        },
        "record": {
          "propertyOrder": 70,
          "type": "object",
          "title": "Recording",
          "description": "Local recording settings",
          "options": {
            "collapsed": true
          },
          "properties": {
            "autostart": {
              "propertyOrder": 10,
              "title": "Autostart",
              "type": "boolean",
              "format": "checkbox",
              "default": false,
              "description": "Automatically record video stream locally on the device. (Requires high-quality SD card)"
            },
            "path": {
              "propertyOrder": 20,
              "title": "Record Path",
              "type": "string",
              "default": "/data/recordings",
              "description": "Recordings storage path. (Make sure directory exists if you change this value)"
            }
          }
        },
        "iFrame": {
          "propertyOrder": 80,
          "type": "object",
          "title": "I-Frame settings",
          "description": "Controls for I-Frames (reference frames)",
          "options": {
            "collapsed": true
          },
          "properties": {
            "period": {
              "propertyOrder": 10,
              "title": "I-frame interval",
              "type": "integer",
              "default": 15,
              "description": "Controls how often a complete reference frame is encoded in the video stream. Smaller intervals provide better quality for fast-moving scenes and faster recovery from packet loss, but use more bandwidth since complete frames are larger than the delta frames sent between them."
            },
            "autoAdjust": {
              "propertyOrder": 20,
              "title": "Enable auto adjusting I Frame size",
              "type": "boolean",
              "format": "checkbox",
              "default": true,
              "description": "This automatically adjusts the compression quality (QP) of I-frames to keep them under a specified size limit. It trades off I-frame quality to prevent bandwidth spikes when reference frames are transmitted."
            },
            "maxBytes": {
              "propertyOrder": 30,
              "title": "Maximum I-frame bytes",
              "type": "integer",
              "default": 25600,
              "description": "Used for auto adjusting I-frames to a specific size. (Only relevant if 'auto adjusting' is enabled)"
            }
          }
        },
        "qp": {
          "propertyOrder": 90,
          "type": "object",
          "title": "Quantization Parameter (QP)",
          "description": "Controls quality-bitrate tradeoff. Lower QP = higher quality/larger files, higher QP = lower quality/smaller files.",
          "options": {
            "collapsed": true
          },
          "properties": {
            "min": {
              "propertyOrder": 10,
              "type": "integer",
              "default": 20,
              "minimum": 0,
              "maximum": 51,
              "title": "Minimum QP",
              "description": "Highest quality allowed. Lower = better quality, larger frames."
            },
            "max": {
              "propertyOrder": 20,
              "type": "integer",
              "default": 51,
              "minimum": 0,
              "maximum": 51,
              "title": "Maximum QP",
              "description": "Lowest quality allowed. Higher = more compression, smaller frames."
            }
          }
        },
        "camera": {
          "propertyOrder": 100,
          "type": "object",
          "title": "Camera Settings",
          "options": {
            "collapsed": true
          },
          "properties": {
            "enableHdr": {
              "propertyOrder": 10,
              "title": "Enable HDR",
              "description": "Only takes effect on cameras with HDR support (PiCam V3, ArduCam IMX708,...) - highly recommended when outside (improves handling of dark/bright transitions)",
              "type": "boolean",
              "format": "checkbox",
              "default": false
            },
            "afMode": {
              "propertyOrder": 20,
              "title": "Auto focus",
              "type": "integer",
              "required": true,
              "enum": [
                0,
                2
              ],
              "options": {
                "enum_titles": [
                  "Disabled",
                  "Continuous"
                ]
              },
              "default": 0,
              "description": "Only takes effect on cameras with focus module (like PiCam V3, some ArduCam models) - if auto focus is disabled, lens position will be applied"
            },
            "lensPosition": {
              "propertyOrder": 30,
              "title": "Lens position",
              "type": "number",
              "default": 0,
              "description": "Only applied when autofocus is disabled. 0: Infinity; Focus(m) = 1/value; Eg.: value = 0.5, Focus = 2m"
            },
            "analogueGainMode": {
              "propertyOrder": 40,
              "title": "Gain Control",
              "type": "integer",
              "required": true,
              "enum": [
                0,
                1
              ],
              "options": {
                "enum_titles": [
                  "Automatic",
                  "Manual"
                ]
              },
              "default": 0,
              "description": "Control how the sensor gain is adjusted. Automatic mode adjusts gain based on lighting conditions; manual mode uses the fixed value below."
            },
            "analogueGain": {
              "propertyOrder": 50,
              "title": "Gain Level",
              "type": "integer",
              "required": true,
              "enum": [
                1,
                2,
                3,
                4,
                5,
                6,
                7,
                8,
                9,
                10,
                11,
                12,
                13,
                14,
                15,
                16
              ],
              "default": 1,
              "description": "Sensor gain multiplier (1-16). Higher values brighten the image in low light but increase noise. Use the lowest value that provides adequate brightness."
            },
            "exposureTimeMode": {
              "propertyOrder": 60,
              "title": "Exposure Control",
              "type": "integer",
              "required": true,
              "enum": [
                0,
                1
              ],
              "options": {
                "enum_titles": [
                  "Automatic",
                  "Manual"
                ]
              },
              "default": 0,
              "description": "Control how exposure time is determined. Automatic mode adjusts exposure based on lighting conditions; manual mode uses the fixed value below."
            },
            "exposureTime": {
              "propertyOrder": 70,
              "title": "Exposure Time (μs)",
              "type": "integer",
              "required": true,
              "default": 32000,
              "description": "Exposure duration in microseconds. Higher values brighten the image but increase motion blur. For video streaming, use the shortest time that provides adequate brightness."
            },
            "sensorMode": {
              "propertyOrder": 80,
              "title": "Force wide FOV",
              "type": "string",
              "required": true,
              "enum": [
                "0x0",
                "2304x1296"
              ],
              "options": {
                "enum_titles": [
                  "Disabled",
                  "RPi Cam v3, Arducam IMX708"
                ]
              },
              "default": "0x0",
              "description": "Some image sensors have wider FOV when requesting higher resolutions. With this setting you can force those higher resolutions to benefit from wider FOV."
            },
            "brightness": {
              "propertyOrder": 90,
              "title": "Brightness",
              "type": "number",
              "required": true,
              "default": 0.0,
              "minimum": -1.0,
              "maximum": 1.0,
              "description": "Change brightness in camera (not supported by all cameras)"
            },
            "contrast": {
              "propertyOrder": 100,
              "title": "Contrast",
              "type": "number",
              "required": true,
              "default": 1.0,
              "minimum": 0.0,
              "maximum": 2.0,
              "description": "Change contrast in camera (not supported by all cameras)"
            },
            "saturation": {
              "propertyOrder": 110,
              "title": "Saturation",
              "type": "number",
              "required": true,
              "default": 1.0,
              "minimum": 0.0,
              "maximum": 2.0,
              "description": "Change saturation in camera (not supported by all cameras)"
            },
            "sharpness": {
              "propertyOrder": 120,
              "title": "Sharpness",
              "type": "number",
              "required": true,
              "default": 0.0,
              "minimum": 0.0,
              "maximum": 10.0,
              "description": "Change sharpness in camera (not supported by all cameras)"
            }
          }
        }
      }
    },
    "control": {
      "propertyOrder": 30,
      "type": "object",
      "title": "Control",
      "description": "Steering, throttle and PWM settings.<br/><i>Changes in this section require the 'v3xctrl-control' service to be restarted!</i>",
      "options": {
        "collapsed": true
      },
      "properties": {
        "autostart": {
          "propertyOrder": 10,
          "type": "boolean",
          "format": "checkbox",
          "default": true,
          "title": "Autostart",
          "description": "Automatically start control service after boot"
        },
        "failsafeTimeout": {
          "propertyOrder": 20,
          "type": "integer",
          "default": 150,
          "title": "Failsafe",
          "description": "After this many ms without a control packet, failsafe is triggered and failsafe values are sent to the peripherals."
        },
        "throttle": {
          "propertyOrder": 30,
          "type": "object",
          "title": "Throttle",
          "options": {
            "collapsed": true
          },
          "properties": {
            "min": {
              "propertyOrder": 10,
              "type": "integer",
              "default": 1000,
              "title": "Minimum PWM pulse width",
              "description": "Check your ESC manual to find out more about range options"
            },
            "max": {
              "propertyOrder": 20,
              "type": "integer",
              "default": 2000,
              "title": "Maximum PWM pulse width",
              "description": "Check your ESC manual to find out more about range options"
            },
            "failsafe": {
              "propertyOrder": 30,
              "type": "integer",
              "default": 1500,
              "title": "Failsafe",
              "description": "Pulse width when failsafe state is detected. (No control messages for a certain time)"
            },
            "idle": {
              "propertyOrder": 40,
              "type": "integer",
              "default": 1500,
              "title": "Idle PWM pulse width",
              "description": "Pulse width for throttle position between forwards and brake/backwards"
            },
            "scaleForward": {
              "propertyOrder": 50,
              "type": "integer",
              "default": 100,
              "minimum": 1,
              "maximum": 100,
              "title": "Scale forward",
              "description": "Scales the throttle forward range as a percentage of the maximum possible value."
            },
            "scaleReverse": {
              "propertyOrder": 60,
              "type": "integer",
              "default": 100,
              "minimum": 1,
              "maximum": 100,
              "title": "Scale reverse",
              "description": "Scales the throttle reverse range as a percentage of the maximum possible value. (You would use this to for example limit your reverse speed to only half the possible speed)"
            },
            "minForward": {
              "propertyOrder": 70,
              "type": "integer",
              "default": 0,
              "title": "Dead-zone forward",
              "description": "Compensate for 'dead-zone' of ESC. Set this to a value just slightly before the motor starts spinning forward."
            },
            "minReverse": {
              "propertyOrder": 80,
              "type": "integer",
              "default": 0,
              "title": "Dead-zone reverse",
              "description": "Compensate for 'dead-zone' of ESC. Set this to a value just slightly before the motor starts spinning reverse."
            }
          }
        },
        "steering": {
          "propertyOrder": 40,
          "type": "object",
          "title": "Steering",
          "options": {
            "collapsed": true
          },
          "properties": {
            "min": {
              "propertyOrder": 10,
              "type": "integer",
              "default": 1000,
              "title": "Minimum PWM pulse width",
              "description": "Check your servo manual to find out more about range options"
            },
            "max": {
              "propertyOrder": 20,
              "type": "integer",
              "default": 2000,
              "title": "Maximum PWM pulse width",
              "description": "Check your servo manual to find out more about range options"
            },
            "failsafe": {
              "propertyOrder": 30,
              "type": "integer",
              "default": 1500,
              "title": "Failsafe",
              "description": "Pulse width when failsafe state is detected. (No control messages for a certain time)"
            },
            "trim": {
              "propertyOrder": 40,
              "type": "integer",
              "default": 0,
              "title": "Trim",
              "description": "Use this to adjust servo position so it is centered without steering input."
            },
            "scale": {
              "propertyOrder": 50,
              "title": "Scale (in percent)",
              "type": "integer",
              "default": 100,
              "minimum": 1,
              "maximum": 100,
              "description": "Scales the steering output range as a percentage of the maximum possible value. Example: setting to '50' will limit the output to 50% of the range and thus PWM pulse width."
            },
            "invert": {
              "propertyOrder": 60,
              "title": "Invert steering",
              "type": "boolean",
              "format": "checkbox",
              "default": false,
              "description": "Check if the servo does move in opposite directions when pressing [a] and [d] in the viewer."
            }
          }
        },
        "pwm": {
          "propertyOrder": 50,
          "type": "object",
          "title": "PWM Channel Mapping",
          "description": "Make sure that each channel is used only once.",
          "options": {
            "collapsed": true
          },
          "properties": {
            "throttle": {
              "title": "Throttle PWM channel",
              "propertyOrder": 10,
              "type": "integer",
              "default": 0,
              "required": true,
              "description": "PWM channel for ESC",
              "enum": [
                0,
                1
              ],
              "options": {
                "enum_titles": [
                  "0 (Pin 18)",
                  "1 (Pin 13)"
                ]
              }
            },
            "steering": {
              "propertyOrder": 20,
              "title": "Steering PWM channel",
              "type": "integer",
              "default": 1,
              "required": true,
              "description": "PWM channel for Servo",
              "enum": [
                0,
                1
              ],
              "options": {
                "enum_titles": [
                  "0 (Pin 18)",
                  "1 (Pin 13)"
                ]
              }
            }
          }
        },
        "telemetry": {
          "propertyOrder": 60,
          "type": "object",
          "title": "Telemetry",
          "description": "Settings for telemetry that is transmitted back to the viewer like battery monitoring.",
          "options": {
            "collapsed": true,
            "disable_edit_json": true,
            "disable_properties": true
          },
          "properties": {
            "battery": {
              "title": "Battery",
              "description": "Battery monitor settings, alarm thresholds min and max values.",
              "propertyOrder": 10,
              "type": "object",
              "options": {
                "collapsed": true,
                "disable_edit_json": true,
                "disable_properties": true
              },
              "properties": {
                "i2cAddress": {
                  "title": "I2C Address",
                  "propertyOrder": 10,
                  "type": "string",
                  "required": true,
                  "default": "0x40",
                  "description": "I2C address of the INA sensor. (Only change if you know that your address differs from defaults)"
                },
                "minVoltage": {
                  "title": "Minimum Voltage (mV)",
                  "propertyOrder": 20,
                  "type": "integer",
                  "required": true,
                  "default": 3500,
                  "description": "Minimum voltage per cell in millivolts (used to calculate battery percentage)"
                },
                "warnVoltage": {
                  "title": "Warning Voltage (mV)",
                  "propertyOrder": 30,
                  "type": "integer",
                  "required": true,
                  "default": 3700,
                  "description": "Level in millivolts at which low voltage warnings should be triggered"
                },
                "maxVoltage": {
                  "title": "Maximum Voltage (mV)",
                  "propertyOrder": 40,
                  "type": "integer",
                  "required": true,
                  "default": 4200,
                  "description": "Maximum voltage per cell in millivolts (used to calculate battery percentage)"
                },
                "shuntResistance": {
                  "title": "Shunt Resistance (mΩ)",
                  "propertyOrder": 50,
                  "type": "integer",
                  "required": true,
                  "default": 100,
                  "description": "Shunt resistor value in milliohms for current measurement"
                },
                "maxExpectedCurrent": {
                  "title": "Max Expected Current (A)",
                  "propertyOrder": 60,
                  "type": "number",
                  "required": true,
                  "default": 0.8,
                  "description": "Maximum expected current in Amperes (affects measurement resolution)"
                }
              }
            }
          }
        }
      }
    },
    "development": {
      "propertyOrder": 50,
      "type": "object",
      "title": "Development",
      "description": "Settings regarding development and debugging.<br /><i>Changes in this section require the streamer to be restarted!</i>",
      "options": {
        "collapsed": true
      },
      "properties": {
        "logLevel": {
          "title": "Log Level",
          "propertyOrder": 10,
          "type": "string",
          "required": true,
          "default": "ERROR",
          "enum": [
            "CRITICAL",
            "ERROR",
            "WARNING",
            "INFO",
            "DEBUG"
          ]
        }
      }
    }
  }
}
